import{B as D,a as A,n as $,t as U,y as d}from"./chunk-3N5DGQTQ.js";import{F as v,Na as T,_ as C,ca as h,g as k,ha as c,n as l}from"./chunk-5HLPFG4U.js";import{a as f,b as g,d as b,f as V}from"./chunk-GAL4ENT6.js";var q=b((oe,R)=>{var W="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function j(r){this.message=r}j.prototype=new Error;j.prototype.name="InvalidCharacterError";function z(r){var i=String(r).replace(/=+$/,"");if(i.length%4==1)throw new j("'atob' failed: The string to be decoded is not correctly encoded.");for(var t=0,e,o,s=0,a="";o=i.charAt(s++);~o&&(e=t%4?e*64+o:o,t++%4)?a+=String.fromCharCode(255&e>>(-2*t&6)):0)o=W.indexOf(o);return a}R.exports=typeof window<"u"&&window.atob&&window.atob.bind(window)||z});var N=b((re,P)=>{var M=q();function K(r){return decodeURIComponent(M(r).replace(/(.)/g,function(i,t){var e=t.charCodeAt(0).toString(16).toUpperCase();return e.length<2&&(e="0"+e),"%"+e}))}P.exports=function(r){var i=r.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}try{return K(i)}catch{return M(i)}}});var J=b((ie,y)=>{"use strict";var X=N();function w(r){this.message=r}w.prototype=new Error;w.prototype.name="InvalidTokenError";y.exports=function(r,i){if(typeof r!="string")throw new w("Invalid token specified");i=i||{};var t=i.header===!0?0:1;try{return JSON.parse(X(r.split(".")[t]))}catch(e){throw new w("Invalid token specified: "+e.message)}};y.exports.InvalidTokenError=w});var L=(()=>{class r{http;apiEndpoint=d.apiEndpoint;constructor(t){this.http=t}test(){return this.http.get(`${this.apiEndpoint}`,{responseType:"text"})}register(t,e){return this.http.post(`${this.apiEndpoint}/auth/register`,g(f({},t),{recaptcha:e}),{withCredentials:!0})}confirm(t){return this.http.get(`${this.apiEndpoint}/auth/confirmation/${t}`)}login(t,e){return this.http.post(`${this.apiEndpoint}/auth/login`,g(f({},t),{recaptcha:e})).pipe(v(o=>l(o.error)))}requestResetPassword(t,e){return this.http.post(`${this.apiEndpoint}/auth/reset-password/request`,g(f({},t),{recaptcha:e})).pipe(v(o=>l(o.error)))}resetPassword(t,e,o){return this.http.post(`${this.apiEndpoint}/auth/reset-password/${e}`,g(f({},t),{recaptcha:o})).pipe(v(s=>l(s.error)))}logout(){return this.http.get(`${this.apiEndpoint}/auth/logout`)}limitedAccessAllowed(){return this.http.get(`${this.apiEndpoint}/limited-access/allowed`)}limitedAccessPassword(t,e){return this.http.post(`${this.apiEndpoint}/limited-access/password`,{password:t,recaptcha:e}).pipe(v(o=>l(o.error)))}refreshToken(t){return this.http.post(`${d.apiEndpoint}/auth/refresh`,{refreshToken:t})}static \u0275fac=function(e){return new(e||r)(c(U))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var B=V(J());var I=(()=>{let i=class i{constructor(e,o){this.document=e,this.platformId=o,this.documentIsAccessible=$(this.platformId)}static getCookieRegExp(e){let o=e.replace(/([\[\]{}()|=;+?,.*^$])/gi,"\\$1");return new RegExp("(?:^"+o+"|;\\s*"+o+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(e){try{return decodeURIComponent(e)}catch{return e}}check(e){return this.documentIsAccessible?(e=encodeURIComponent(e),i.getCookieRegExp(e).test(this.document.cookie)):!1}get(e){if(this.check(e)){e=encodeURIComponent(e);let s=i.getCookieRegExp(e).exec(this.document.cookie);return s&&s[1]?i.safeDecodeURIComponent(s[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let e={},o=this.document;return o.cookie&&o.cookie!==""&&o.cookie.split(";").forEach(s=>{let[a,p]=s.split("=");e[i.safeDecodeURIComponent(a.replace(/^ /,""))]=i.safeDecodeURIComponent(p)}),e}set(e,o,s,a,p,m,S,G){if(!this.documentIsAccessible)return;if(typeof s=="number"||s instanceof Date||a||p||m||S){let E={expires:s,path:a,domain:p,secure:m,sameSite:S||"Lax",partitioned:G};this.set(e,o,E);return}let u=encodeURIComponent(e)+"="+encodeURIComponent(o)+";",n=s||{};if(n.expires)if(typeof n.expires=="number"){let E=new Date(new Date().getTime()+n.expires*1e3*60*60*24);u+="expires="+E.toUTCString()+";"}else u+="expires="+n.expires.toUTCString()+";";n.path&&(u+="path="+n.path+";"),n.domain&&(u+="domain="+n.domain+";"),n.secure===!1&&n.sameSite==="None"&&(n.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${e} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),n.secure&&(u+="secure;"),n.sameSite||(n.sameSite="Lax"),u+="sameSite="+n.sameSite+";",n.partitioned&&(u+="Partitioned;"),this.document.cookie=u}delete(e,o,s,a,p="Lax"){if(!this.documentIsAccessible)return;let m=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(e,"",{expires:m,path:o,domain:s,secure:a,sameSite:p})}deleteAll(e,o,s,a="Lax"){if(!this.documentIsAccessible)return;let p=this.getAll();for(let m in p)p.hasOwnProperty(m)&&this.delete(m,e,o,s,a)}};i.\u0275fac=function(o){return new(o||i)(c(A),c(T))},i.\u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"});let r=i;return r})();var H=(()=>{class r{cookieService;userLoggedInSubject;userLoggedIn;constructor(t){this.cookieService=t,this.userLoggedInSubject=new k(this.cookieService.check("vgmq-ut-hp")),this.userLoggedIn=this.userLoggedInSubject.asObservable()}isUserLoggedIn(){return this.userLoggedInSubject.getValue()}setUserLoggedIn(t){this.userLoggedInSubject.next(t)}static \u0275fac=function(e){return new(e||r)(c(I))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var le=(()=>{class r{cookieService;authHttpService;router;userStore;apiEndpoint=d.apiEndpoint;userSubject;VGMQMaintenanceSubject;constructor(t,e,o,s){this.cookieService=t,this.authHttpService=e,this.router=o,this.userStore=s,this.userSubject=new k(this.decodeJwt()),this.VGMQMaintenanceSubject=new k(!1)}get isLoggedIn(){return this.cookieService.check("vgmq-ut-hp")}logout(){this.cookieService.delete("vgmq-ut-hp","/",d.cookieDomain),this.cookieService.delete("vgmq-ut-s","/",d.cookieDomain),this.cookieService.delete("vgmq-urt","/",d.cookieDomain),this.userStore.setUserLoggedIn(!1),this.router.navigate(["/"])}decodeJwt(){return this.getAccessToken()==="."?null:(0,B.default)(this.getAccessToken())}get isAdmin(){return this.decodeJwt().roles?.includes("admin")}getAccessToken(){return`${this.cookieService.get("vgmq-ut-hp")}.${this.cookieService.get("vgmq-ut-s")}`}setAccessTokenCookie(t){let e=t.split(".");this.cookieService.set("vgmq-ut-hp",`${e[0]}.${e[1]}`,void 0,"/"),this.cookieService.set("vgmq-ut-s",e[2],void 0,"/"),this.userStore.setUserLoggedIn(!0),this.userSubject.next(this.decodeJwt())}setRefreshTokenCookie(t){this.cookieService.set("vgmq-urt",t,void 0,"/")}refreshToken(){let t=this.cookieService.get("vgmq-urt");return t===null?(this.logout(),l(()=>new Error("no refresh token"))):this.authHttpService.refreshToken(t).pipe(C(e=>{this.setAccessTokenCookie(e.accessToken)}))}loginWithGoogle(){window.location.href=`${this.apiEndpoint}/oauth/google`}static \u0275fac=function(e){return new(e||r)(c(I),c(L),c(D),c(H))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();export{L as a,H as b,le as c};
