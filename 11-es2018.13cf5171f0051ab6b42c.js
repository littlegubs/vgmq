(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{VTKI:function(t,e,s){"use strict";s.r(e),s.d(e,"LobbyModule",(function(){return Q}));var o=s("ofXK"),n=s("fXoL"),b=s("3Pt+"),i=s("XYSw"),c=s("eLK+"),r=s("wFdA"),a=s("tyNb"),l=s("l7P3");let u=(()=>{class t{constructor(t,e,s,o,n){this.fb=t,this.lobbyHttpService=e,this.router=s,this.route=o,this.store=n,this.userCanEdit=!0,this.subscriptions=[]}ngOnInit(){this.lobbyForm=this.fb.group({name:["",b.s.required.bind(this)],password:[""]}),this.create||this.subscriptions.push(this.store.select("lobby").subscribe(t=>{this.lobby=t.lobby,this.lobbyForm.controls.name.setValue(this.lobby.name),this.lobbyForm.controls.password.setValue(this.lobby.password),this.userCanEdit=t.role===c.b.Host,this.userCanEdit?this.lobbyForm.enable():this.lobbyForm.disable()}))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}submit(){this.create?this.lobbyHttpService.create(new i.a({name:this.lobbyForm.get("name").value,password:this.lobbyForm.get("password").value})).subscribe(t=>{this.router.navigate(["/lobby/"+t.code])}):this.lobbyHttpService.update(this.lobby.code,new i.a({name:this.lobbyForm.get("name").value,password:this.lobbyForm.get("password").value})).subscribe(t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(n.Jb(b.c),n.Jb(r.a),n.Jb(a.b),n.Jb(a.a),n.Jb(l.h))},t.\u0275cmp=n.Db({type:t,selectors:[["app-lobby-config"]],inputs:{create:"create"},decls:5,vars:2,consts:[[3,"formGroup","ngSubmit"],["type","text","formControlName","name","placeholder","Room name","required","required"],["type","text","formControlName","password","placeholder","Password (keep empty if public)"],["type","submit"]],template:function(t,e){1&t&&(n.Ob(0,"form",0),n.Vb("ngSubmit",(function(){return!e.userCanEdit||e.submit()})),n.Kb(1,"input",1),n.Kb(2,"input",2),n.Ob(3,"button",3),n.yc(4),n.Nb(),n.Nb()),2&t&&(n.gc("formGroup",e.lobbyForm),n.zb(4),n.zc(e.create?"Create":"Save"))},directives:[b.t,b.n,b.h,b.b,b.m,b.f,b.r],encapsulation:2}),t})(),p=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Db({type:t,selectors:[["app-create"]],decls:1,vars:1,consts:[[3,"create"]],template:function(t,e){1&t&&n.Kb(0,"app-lobby-config",0),2&t&&n.gc("create",!0)},directives:[u],encapsulation:2}),t})();var h=s("PCNd"),y=s("mDxo"),d=s("f7Zi"),f=s("2Vo4"),m=s("AytR");let g=(()=>{class t{constructor(t){this.store=t,this.subject=new f.a([])}on(){return this.subject.asObservable()}joinLobby(t){if(void 0===this.eventSource){const e=new URL(m.a.mercureEndpoint);e.searchParams.append("topic",`${m.a.apiEndpoint}/lobbies/${t.code}`),e.searchParams.append("topic",`/.well-known/mercure/subscriptions/${m.a.apiEndpoint}/lobbies/${t.code}{/subscriber}`),this.eventSource=new EventSource(e.toString(),{withCredentials:!0}),this.eventSource.onopen=t=>{console.log(t)},this.eventSource.onmessage=t=>{console.log(t)},this.eventSource.addEventListener("configUpdated",t=>{this.store.dispatch(Object(y.d)({lobby:new i.a(JSON.parse(t.data))}))}),this.eventSource.addEventListener("updateLobbyUsers",t=>{const e=JSON.parse(t.data);Array.isArray(e)&&this.store.dispatch(Object(y.f)({lobbyUsers:e.map(t=>new c.a(t))}))}),this.eventSource.addEventListener("updateLobbyStatus",t=>{this.store.dispatch(Object(y.e)({status:t.data}))}),this.eventSource.addEventListener("updateLobby",t=>{console.log(JSON.parse(t.data)),this.store.dispatch(Object(y.d)({lobby:new i.a(JSON.parse(t.data))}))}),this.eventSource.addEventListener("availableGameChoices",t=>{this.store.dispatch(Object(y.c)({gameNames:JSON.parse(t.data)}))}),this.eventSource.onerror=t=>{console.log(t)}}}disconnect(){this.eventSource.close(),this.eventSource=void 0}}return t.\u0275fac=function(e){return new(e||t)(n.Sb(l.h))},t.\u0275prov=n.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var v=s("0IaG"),w=s("ipG3");function S(t,e){1&t&&(n.Mb(0),n.yc(1,"gg"),n.Lb())}function O(t,e){1&t&&n.Kb(0,"i",4)}function C(t,e){if(1&t&&(n.Ob(0,"span"),n.yc(1),n.Nb()),2&t){const t=n.Zb().$implicit;n.zb(1),n.zc(t.points)}}function L(t,e){if(1&t&&(n.Ob(0,"span"),n.yc(1),n.Nb()),2&t){const t=n.Zb().$implicit;n.zb(1),n.Ac("-> ",t.answer,"")}}function I(t,e){if(1&t&&(n.Ob(0,"div"),n.Ob(1,"span",2),n.wc(2,O,1,0,"i",3),n.wc(3,C,2,1,"span",0),n.yc(4),n.wc(5,L,2,1,"span",0),n.Nb(),n.Nb()),2&t){const t=e.$implicit,s=n.Zb();n.zb(1),n.gc("ngClass",s.getStatusClass(t)),n.zb(1),n.gc("ngIf",t.role===s.lobbyUserRoles.Host),n.zb(1),n.gc("ngIf",s.lobbyStatus!==s.lobbyStatuses.Waiting),n.zb(1),n.Ac(" ",t.user.username," "),n.zb(1),n.gc("ngIf",t.answer)}}let N=(()=>{class t{constructor(t){this.store=t,this.showRank=!1,this.lobbyStatuses=i.c,this.lobbyUserRoles=c.b}ngOnInit(){this.store.select(w.e).subscribe(t=>{this.users=t}),this.store.select(w.d).subscribe(t=>{this.lobbyStatus=t})}getStatusClass(t){return t.disconnected?"text-muted":t.status===c.c.WrongAnswer?"text-danger":t.status===c.c.CorrectAnswer?"text-success":t.answered?"text-primary":void 0}}return t.\u0275fac=function(e){return new(e||t)(n.Jb(l.h))},t.\u0275cmp=n.Db({type:t,selectors:[["app-lobby-users"]],inputs:{showRank:"showRank"},decls:3,vars:2,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngClass"],["class","fa fa-star mr-1",4,"ngIf"],[1,"fa","fa-star","mr-1"]],template:function(t,e){1&t&&(n.Mb(0),n.wc(1,S,2,0,"ng-container",0),n.wc(2,I,6,5,"div",1),n.Lb()),2&t&&(n.zb(1),n.gc("ngIf",e.showRank),n.zb(1),n.gc("ngForOf",e.users))},directives:[o.l,o.k,o.j],encapsulation:2}),t})();function J(t,e){1&t&&(n.Mb(0),n.yc(1,"(loading)"),n.Lb())}function E(t,e){if(1&t){const t=n.Pb();n.Mb(0),n.Ob(1,"button",1),n.Vb("click",(function(){return n.nc(t),n.Zb().play()})),n.yc(2,"Play "),n.wc(3,J,2,0,"ng-container",0),n.Nb(),n.Lb()}if(2&t){const t=n.Zb();n.zb(3),n.gc("ngIf",t.lobby.status===t.lobbyStatus.Loading)}}function z(t,e){1&t&&(n.Mb(0),n.yc(1,"(loading)"),n.Lb())}function j(t,e){if(1&t&&(n.Mb(0),n.Ob(1,"button",2),n.yc(2,"Ready "),n.wc(3,z,2,0,"ng-container",0),n.Nb(),n.Lb()),2&t){const t=n.Zb();n.zb(3),n.gc("ngIf",t.lobby.status===t.lobbyStatus.Loading)}}let k=(()=>{class t{constructor(t,e){this.lobbyHttpService=t,this.store=e,this.lobbyUsersRoles=c.b,this.lobbyStatus=i.c,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.store.select("lobby").subscribe(t=>{this.lobby=t.lobby,this.role=t.role,console.log(this.role)}))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}play(){this.lobbyHttpService.play(this.lobby.code).subscribe(()=>{})}}return t.\u0275fac=function(e){return new(e||t)(n.Jb(r.a),n.Jb(l.h))},t.\u0275cmp=n.Db({type:t,selectors:[["app-button-play"]],decls:2,vars:2,consts:[[4,"ngIf"],["type","button",3,"click"],["type","button"]],template:function(t,e){1&t&&(n.wc(0,E,4,1,"ng-container",0),n.wc(1,j,4,1,"ng-container",0)),2&t&&(n.gc("ngIf",e.role===e.lobbyUsersRoles.Host),n.zb(1),n.gc("ngIf",e.role===e.lobbyUsersRoles.Player))},directives:[o.l],encapsulation:2}),t})(),F=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Db({type:t,selectors:[["app-lobby-waiting"]],decls:2,vars:0,template:function(t,e){1&t&&(n.Kb(0,"app-lobby-config"),n.Kb(1,"app-button-play"))},directives:[u,k],encapsulation:2}),t})(),A=(()=>{class t{constructor(t){this.store=t}ngOnInit(){this.store.select("lobby").subscribe(t=>{var e;void 0!==this.lobby&&this.lobby.status!==t.lobby.status&&(void 0!==t.lobby.currentMusic?(void 0!==this.audio&&this.audio.pause(),this.audio=new Audio,this.audio.src=t.lobby.currentMusic.music.awsUrl,this.audio.volume=.1,this.audio.currentTime=t.lobby.currentMusic.startAt,this.audio.play()):null===(e=this.audio)||void 0===e||e.pause()),this.lobby=t.lobby})}ngOnDestroy(){var t;null===(t=this.audio)||void 0===t||t.pause()}}return t.\u0275fac=function(e){return new(e||t)(n.Jb(l.h))},t.\u0275cmp=n.Db({type:t,selectors:[["app-lobby-audio-player"]],decls:2,vars:0,template:function(t,e){1&t&&(n.Ob(0,"p"),n.yc(1,"audio-player works!"),n.Nb())},encapsulation:2}),t})();var K=s("PqYM"),M=s("IzEk"),R=s("lJxs");let D=(()=>{class t{constructor(t){this.store=t}ngOnInit(){this.store.select("lobby").subscribe(t=>{void 0!==this.lobby&&this.lobby.status!==t.lobby.status&&(this.guessTime=t.lobby.guessTime,this.counter=Object(K.a)(0,1e3).pipe(Object(M.a)(this.guessTime),Object(R.a)(()=>--this.guessTime))),this.lobby=t.lobby})}}return t.\u0275fac=function(e){return new(e||t)(n.Jb(l.h))},t.\u0275cmp=n.Db({type:t,selectors:[["app-lobby-countdown"]],decls:2,vars:3,template:function(t,e){1&t&&(n.yc(0),n.ac(1,"async")),2&t&&n.Ac("",n.bc(1,1,e.counter),"\n")},pipes:[o.b],encapsulation:2}),t})();var H=s("JX91"),P=s("kmnG"),x=s("qFsG"),U=s("/1cH"),V=s("FKr1");function Z(t,e){if(1&t&&(n.Ob(0,"mat-option",5),n.yc(1),n.Nb()),2&t){const t=e.$implicit;n.gc("value",t),n.zb(1),n.Ac(" ",t," ")}}let G=(()=>{class t{constructor(t,e){this.store=t,this.lobbyHttpService=e,this.myControl=new b.d,this.gameNames=[],this.lobbyStatuses=i.c}ngOnInit(){this.store.select(w.b).subscribe(t=>{t&&(this.gameNames=t)}),this.store.select(w.c).subscribe(t=>{void 0!==this.lobby&&this.lobby.status!==t.status&&(t.status===i.c.AnswerReveal?this.myControl.disable():(this.myControl.enable(),this.myControl.setValue(""))),this.lobby=t}),this.filteredOptions=this.myControl.valueChanges.pipe(Object(H.a)(""),Object(R.a)(t=>this.filter(null===t?"":t)))}submit(){this.lobbyHttpService.answer(this.lobby.code,this.myControl.value).subscribe(()=>{})}filter(t){const e=t.toLowerCase();return this.gameNames.filter(t=>t.toLowerCase().includes(e))}}return t.\u0275fac=function(e){return new(e||t)(n.Jb(l.h),n.Jb(r.a))},t.\u0275cmp=n.Db({type:t,selectors:[["app-lobby-answer"]],decls:8,vars:9,consts:[[3,"ngSubmit"],[2,"width","100%"],["type","text","placeholder","Pick one","aria-label","Number","matInput","",3,"formControl","matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){if(1&t&&(n.Ob(0,"form",0),n.Vb("ngSubmit",(function(){return e.lobby.status===e.lobbyStatuses.AnswerReveal||e.submit()})),n.Ob(1,"mat-form-field",1),n.Kb(2,"input",2),n.Ob(3,"mat-autocomplete",null,3),n.wc(5,Z,2,2,"mat-option",4),n.ac(6,"slice"),n.ac(7,"async"),n.Nb(),n.Nb(),n.Nb()),2&t){const t=n.mc(4);n.zb(2),n.gc("formControl",e.myControl)("matAutocomplete",t),n.zb(3),n.gc("ngForOf",n.dc(6,3,n.bc(7,7,e.filteredOptions),0,30))}},directives:[b.t,b.n,b.o,P.b,x.a,b.b,U.c,b.m,b.e,U.a,o.k,V.f],pipes:[o.q,o.b],encapsulation:2}),t})(),$=(()=>{class t{constructor(t){this.store=t}ngOnInit(){this.store.select("lobby").subscribe(t=>{this.lobby=t.lobby})}}return t.\u0275fac=function(e){return new(e||t)(n.Jb(l.h))},t.\u0275cmp=n.Db({type:t,selectors:[["app-lobby-center-container"]],decls:4,vars:1,template:function(t,e){1&t&&(n.yc(0),n.Kb(1,"app-lobby-audio-player"),n.Kb(2,"app-lobby-countdown"),n.Kb(3,"app-lobby-answer")),2&t&&n.Ac("",null==e.lobby||null==e.lobby.currentMusic||null==e.lobby.currentMusic.expectedAnswer?null:e.lobby.currentMusic.expectedAnswer.name," ")},directives:[A,D,G],encapsulation:2}),t})(),T=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Db({type:t,selectors:[["app-lobby-playing"]],decls:1,vars:0,template:function(t,e){1&t&&n.Kb(0,"app-lobby-center-container")},directives:[$],encapsulation:2}),t})();function q(t,e){1&t&&(n.Mb(0),n.Kb(1,"app-lobby-waiting"),n.Lb())}function X(t,e){1&t&&(n.Mb(0),n.Kb(1,"app-lobby-playing"),n.Lb())}function W(t,e){if(1&t){const t=n.Pb();n.Mb(0),n.Ob(1,"button",2),n.Vb("click",(function(){return n.nc(t),n.Zb().leave()})),n.yc(2,"Leave"),n.Nb(),n.wc(3,q,2,0,"ng-container",3),n.wc(4,X,2,0,"ng-container",3),n.Kb(5,"app-lobby-users",4),n.Lb()}if(2&t){const t=n.Zb();n.zb(3),n.gc("ngIf",t.lobby.isWaiting()),n.zb(1),n.gc("ngIf",t.lobby.isPLaying()),n.zb(1),n.gc("showRank",t.lobby.isFinalStanding())}}function Y(t,e){1&t&&n.yc(0,"loading")}const B=[{path:"create",component:p},{path:":code",component:(()=>{class t{constructor(t,e,s,o,n,b){this.lobbyHttpService=t,this.router=e,this.route=s,this.lobbyEventSourceService=o,this.store=n,this.dialog=b,this.lobbyStatuses=i.c,this.subscriptions=[]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.store.dispatch(Object(y.a)()),this.lobbyEventSourceService.disconnect()}ngOnInit(){this.subscriptions.push(this.store.select("lobby").subscribe(t=>{t.lobby?(this.lobby=t.lobby,this.lobbyEventSourceService.joinLobby(this.lobby)):(this.route.paramMap.subscribe(t=>{this.lobbyCode=t.get("code")}),this.lobbyHttpService.join(this.lobbyCode).subscribe(t=>{this.dispatchLobby(t)},t=>{401===t.status&&this.dialog.open(d.a,{data:this.lobbyCode}).afterClosed().subscribe(t=>{t instanceof i.b?this.dispatchLobby(t):this.router.navigate(["/"])})}))}))}leave(){this.lobbyHttpService.leave(this.lobbyCode).subscribe(()=>{this.router.navigate(["/"]),this.store.dispatch(Object(y.a)())})}dispatchLobby(t){this.lobby=t.lobby,this.lobbyEventSourceService.joinLobby(this.lobby),this.store.dispatch(Object(y.b)({lobby:this.lobby,role:t.role,gameNames:t.gameNames}))}}return t.\u0275fac=function(e){return new(e||t)(n.Jb(r.a),n.Jb(a.b),n.Jb(a.a),n.Jb(g),n.Jb(l.h),n.Jb(v.b))},t.\u0275cmp=n.Db({type:t,selectors:[["app-lobby"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],["type","button",1,"btn","btn-primary-reverse",3,"click"],[4,"ngIf"],[3,"showRank"]],template:function(t,e){if(1&t&&(n.wc(0,W,6,3,"ng-container",0),n.wc(1,Y,1,0,"ng-template",null,1,n.xc)),2&t){const t=n.mc(2);n.gc("ngIf",e.lobby)("ngIfElse",t)}},directives:[o.l,N,F,T],encapsulation:2}),t})()},{path:"**",redirectTo:"create"}];let Q=(()=>{class t{}return t.\u0275mod=n.Hb({type:t}),t.\u0275inj=n.Gb({factory:function(e){return new(e||t)},providers:[r.a,g],imports:[[o.c,a.f.forChild(B),h.a]]}),t})()}}]);