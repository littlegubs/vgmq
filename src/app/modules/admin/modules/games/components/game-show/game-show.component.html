<ng-container *ngIf="loading; else gameShow">
  <div class="d-flex justify-content-center">
    <div class="spinner-border orange" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</ng-container>
<ng-template #gameShow>
  <div class="progress bg-dark">
    <div
      class="progress-bar text-black"
      role="progressbar"
      [style.width]="((size - free) / size) * 100 + '%'"
      [attr.aria-valuenow]="((size - free) / size) * 100"
      aria-valuemin="0"
      aria-valuemax="100"
      matTooltip="Space used"
    >
      {{ ((size - free) / size) * 100 | number: '1.0-2' }}%
    </div>
  </div>
  <h1>{{ game.name }} <a mat-stroked-button href="{{ game.url }}" target="_blank">IDGB</a></h1>
  <div class="row">
    <div class="col-md-12">
      enabled
      <mat-slide-toggle
        color="primary"
        [(ngModel)]="game.enabled"
        [disabled]="toggleLoading"
        (click)="loading || toggle()"
      ></mat-slide-toggle>
      <span
        class="spinner-border text-primary spinner-border-sm"
        role="status"
        aria-hidden="true"
        *ngIf="toggleLoading"
      ></span>
      <span class="text-danger" *ngIf="toggleErrorMessage">{{ toggleErrorMessage }}</span>
    </div>
    <div class="col-md-8">
      <h2>Musics</h2>
      <div [formGroup]="musicUploadForm" class="form-group">
        <label for="exampleFormControlFile1">add musics</label>
        <input
          type="file"
          class="form-control-file"
          id="exampleFormControlFile1"
          formControlName="musics"
          multiple
          (change)="fileUpload($event)"
          accept="audio/mpeg"
          [ngClass]="{ 'is-invalid': musics.invalid && (musics.dirty || musics.touched) }"
        />
        <mat-progress-bar mode="determinate" [value]="fileUploadProgress"></mat-progress-bar>
        <div *ngIf="musics.errors" class="invalid-feedback">
          {{ musics.errors.apiError }}
        </div>
        <button
          class="btn btn-outline-primary"
          [disabled]="uploadLoading || musicFiles.length === 0"
          (click)="uploadLoading || musicFiles.length === 0 || uploadMusic()"
        >
          Upload
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" *ngIf="uploadLoading"></span>
        </button>
      </div>
      <table class="table table-dark table-striped">
        <thead class="thead-dark">
          <tr>
            <th scope="col">title</th>
            <th scope="col">artist</th>
            <th scope="col">duration</th>
            <th scope="col">accuracy</th>
            <th scope="col">played</th>
            <th scope="col">action</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let gameMusic of game.musics; index as i">
            <tr musicRow [gameMusic]="gameMusic" (remove)="handleGameMusicDeleted(i)"></tr>
          </ng-container>
        </tbody>
      </table>
    </div>
    <div class="col-md-4">
      <table class="table table-dark table-striped">
        <thead class="thead-dark">
          <tr>
            <th scope="col">Alternative names</th>
            <th scope="col">Enabled</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let alternativeName of game.alternativeNames">
            <tr alternativeNameRow [alternativeName]="alternativeName" [disabled]="!game.enabled"></tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</ng-template>
