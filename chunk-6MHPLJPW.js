import{a as le}from"./chunk-AG3Z7YZV.js";import{B as x,D as X,H as Z,K as Q,Ka as ie,La as re,Ma as oe,Na as se,Q as ee,ha as te,hb as ae,ja as ne,v as z,w as g,x as W,y as J,z as T}from"./chunk-5KVTLUS6.js";import{c as E}from"./chunk-3VSYNEYF.js";import{E as L,d as q,f as S,j as B,m as Y,t as $,y as K}from"./chunk-3N5DGQTQ.js";import{Bb as m,Dc as h,Fc as G,Hc as O,M as v,Nb as l,Sb as I,Ub as j,Vb as A,Wb as V,Xb as r,Yb as i,Zb as f,bc as k,ca as U,da as N,gc as c,ha as H,hc as d,ib as s,nb as u,qa as C,ra as b,tc as o,uc as w,vb as P,vc as y,wb as R}from"./chunk-5HLPFG4U.js";import"./chunk-GAL4ENT6.js";var M=(()=>{class e{http;apiEndpoint=K.apiEndpoint;constructor(n){this.http=n}getCurrentUser(){return this.http.get(`${this.apiEndpoint}/users/current`)}updatePassword(n,a){return this.http.post(`${this.apiEndpoint}/users/password/update`,{password:n,newPassword:a})}updateUsername(n){return this.http.post(`${this.apiEndpoint}/users/username/update`,{username:n})}deleteUser(){return this.http.delete(`${this.apiEndpoint}/users`)}static \u0275fac=function(a){return new(a||e)(H($))};static \u0275prov=U({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function he(e,p){if(e&1&&(r(0,"p",7),o(1),i()),e&2){let n=d();s(),w(n.errorMessage)}}var me=(()=>{class e{dialogRef;profileHttpService;authService;errorMessage;constructor(n,a,t){this.dialogRef=n,this.profileHttpService=a,this.authService=t}submit(){this.profileHttpService.deleteUser().subscribe({next:()=>{this.dialogRef.close(),this.authService.logout()},error:({error:n})=>{this.errorMessage=n.message}})}close(){this.dialogRef.close()}static \u0275fac=function(a){return new(a||e)(u(te),u(M),u(E))};static \u0275cmp=P({type:e,selectors:[["app-confirm-delete-dialog"]],standalone:!1,decls:11,vars:1,consts:[[1,"tw-flex","tw-flex-col","tw-items-center","!tw-bg-grey"],[1,"!tw-mb-6","!tw-mt-2","tw-text-white","!tw-font-fastup","!tw-text-5xl","tw-text-center","tw-px-6"],[1,"tw-text-center","tw-font-bold"],[1,"tw-flex","tw-justify-center","tw-pb-4"],[1,"btn","tw-bg-red","tw-border-none","tw-text-white","hover:tw-border-solid","hover:tw-border-red",3,"click"],[1,"tw-ml-4","btn","btn-outline-primary",3,"click"],["class","text-danger tw-text-center",4,"ngIf"],[1,"text-danger","tw-text-center"]],template:function(a,t){a&1&&(r(0,"div",0)(1,"h1",1),o(2," Confirm Delete account "),i(),r(3,"p",2),o(4,"This action is irreversible, are you sure ?"),i(),r(5,"div",3)(6,"button",4),c("click",function(){return t.submit()}),o(7," Delete "),i(),r(8,"button",5),c("click",function(){return t.close()}),o(9,"Cancel"),i()(),m(10,he,2,1,"p",6),i()),a&2&&(s(10),l("ngIf",t.errorMessage))},dependencies:[S],encapsulation:2})}return e})();function de(){return e=>{let p=e.get("newPassword"),n=e.get("confirmNewPassword");return p&&n&&p.value!==n.value?{passwordMismatch:!0}:null}}var F=e=>({"is-invalid":e}),ce=e=>({disabled:e});function _e(e,p){if(e&1&&(r(0,"span",26),o(1),i()),e&2){let n=p.$implicit;s(),w(n)}}function ve(e,p){if(e&1&&(r(0,"p"),o(1," You unlocked benefits from these tiers: "),A(2,_e,2,1,"span",26,j),i()),e&2){let n=d(2);s(2),V(n.user.entitledTiers)}}function xe(e,p){e&1&&(r(0,"p"),o(1,"You haven't pledge to any tier"),i())}function Ce(e,p){e&1&&f(0,"span",27)}function be(e,p){e&1&&f(0,"span",27)}function Pe(e,p){if(e&1){let n=k();r(0,"p"),o(1,"Account linked with your Patreon account!"),i(),m(2,ve,4,0,"p")(3,xe,2,0,"p"),r(4,"div",24)(5,"button",25),c("click",function(){C(n);let t=d();return b(!t.loadingUnlinkPatreon&&t.unlinkPatreon())}),o(6," Unlink account "),m(7,Ce,1,0,"span",17),i(),r(8,"button",25),c("click",function(){C(n);let t=d();return b(!t.loadingRefreshPatreon&&t.refreshPatreon())}),o(9," Refresh data "),m(10,be,1,0,"span",17),i()()}if(e&2){let n=d();s(2),I((n.user==null?null:n.user.entitledTiers.length)>0?2:3),s(3),l("ngClass",h(5,ce,n.loadingUnlinkPatreon)),s(2),l("ngIf",n.loadingUnlinkPatreon),s(),l("ngClass",h(7,ce,n.loadingRefreshPatreon)),s(2),l("ngIf",n.loadingRefreshPatreon)}}function ye(e,p){if(e&1){let n=k();r(0,"p"),o(1,"Connect your account with Patreon to retrieve your benefits!"),i(),r(2,"div",28)(3,"button",29),c("click",function(){C(n);let t=d();return b(t.patreonOAuth())}),o(4,"Connect"),i()()}}function Se(e,p){if(e&1&&(r(0,"p",30),o(1),i()),e&2){let n=d();s(),w(n.errorMessage)}}function Ee(e,p){if(e&1&&(r(0,"p",31),o(1),i()),e&2){let n=d();s(),w(n.successMessage)}}function Me(e,p){e&1&&f(0,"span",27)}function Fe(e,p){e&1&&(r(0,"p",32),o(1,"Passwords not match"),i())}function Ie(e,p){if(e&1&&(r(0,"p",30),o(1),i()),e&2){let n=d();s(),w(n.errorMessage)}}function ke(e,p){if(e&1&&(r(0,"p",31),o(1),i()),e&2){let n=d();s(),w(n.successMessage)}}function Te(e,p){e&1&&f(0,"span",27)}function De(e,p){e&1&&f(0,"span",27)}var ue=(()=>{class e{dialog;profileHttpService;oauthHttpService;authService;user;userSub;loading=!1;errorMessage;successMessage;passwordForm=new T({currentPassword:new x("",g.required.bind(this)),newPassword:new x("",[g.required.bind(this),g.minLength(3)]),confirmNewPassword:new x("",[g.required.bind(this),g.minLength(3)])},{validators:de()});usernameForm=new T({username:new x("",[g.required.bind(this),g.minLength(4)])});loadingUnlinkPatreon=!1;loadingRefreshPatreon=!1;constructor(n,a,t,_){this.dialog=n,this.profileHttpService=a,this.oauthHttpService=t,this.authService=_}ngOnInit(){this.userSub=this.getCurrentUser()}getCurrentUser(){return this.profileHttpService.getCurrentUser().subscribe(n=>{this.user=n})}submitUpdatePassword(){this.errorMessage=void 0,this.successMessage=void 0,this.loading=!0;let n=this.passwordForm.value;this.profileHttpService.updatePassword(n.currentPassword,n.newPassword).pipe(v(()=>{this.loading=!1,this.passwordForm.reset()})).subscribe({next:()=>{this.successMessage="Password changed successfully"},error:({error:a})=>{this.errorMessage=a.message}})}submitUpdateUsername(){this.errorMessage=void 0,this.successMessage=void 0,this.loading=!0;let n=this.usernameForm.value;this.profileHttpService.updateUsername(n.username).pipe(v(()=>{this.loading=!1,this.usernameForm.reset()})).subscribe({next:a=>{this.successMessage="Username changed successfully",this.authService.setAccessTokenCookie(a.accessToken),this.authService.setRefreshTokenCookie(a.refreshToken),this.getCurrentUser()},error:({error:a})=>{this.errorMessage=a.message}})}openDeleteDialog(){this.dialog.open(me)}ngOnDestroy(){this.userSub.unsubscribe()}patreonOAuth(){window.open(`https://www.patreon.com/oauth2/authorize?response_type=code&client_id=nfItBwy3Cx9lObjpVyANkAgm3Z6GFHHoBOGIg_cCJY4lI-Xqwx6rdmKKKozBxSx9&redirect_uri=${window.location.origin}/oauth/patreon`,"_self")}refreshPatreon(){this.loadingRefreshPatreon=!0,this.oauthHttpService.refreshPatreon().subscribe(()=>{this.profileHttpService.getCurrentUser().pipe(v(()=>this.loadingRefreshPatreon=!1)).subscribe(n=>{this.user=n})})}unlinkPatreon(){this.loadingUnlinkPatreon=!0,this.oauthHttpService.unlinkPatreon().pipe(v(()=>this.loadingUnlinkPatreon=!1)).subscribe(()=>{this.user.patreonAccount=null})}static \u0275fac=function(a){return new(a||e)(u(ne),u(M),u(le),u(E))};static \u0275cmp=P({type:e,selectors:[["app-profile"]],standalone:!1,decls:72,vars:32,consts:[[1,"tw-flex","tw-flex-col","md:tw-flex-row","tw-w-full","md:tw-justify-center","tw-items-center","tw-gap-4"],[1,"tw-flex","tw-flex-col","tw-flex-1"],[1,"tw-text-center","!tw-text-2xl","!tw-font-fastup"],[1,"tw-font-bold"],[1,"tw-my-4"],[1,"bg-dark","tw-mt-2","tw-rounded-3xl"],[1,"tw-p-4"],[1,"tw-my-2"],["height","24px","width","24px","src","assets/svg/PATREON_SYMBOL_1_WHITE_RGB.svg"],["height","24px","src","assets/svg/PATREON_WORDMARK_1_WHITE_RGB.svg",1,"tw-ms-[12px]"],[1,"!tw-bg-newBlack"],[1,"tw-flex","tw-flex-col","tw-items-center"],[1,"tw-w-3/4",3,"ngSubmit","formGroup"],["type","text","required","","formControlName","username",1,"form-control","!tw-bg-grey","tw-rounded-md","placeholder:tw-text-light-grey","tw-mt-2",3,"placeholder","ngClass"],["class","!tw-my-4 text-danger tw-text-center",4,"ngIf"],["class","!tw-my-4 text-success tw-text-center",4,"ngIf"],["type","submit",1,"btn","btn-outline-primary",3,"disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","password","required","","formControlName","currentPassword","placeholder","Current Password",1,"form-control","!tw-bg-grey","tw-rounded-md","placeholder:tw-text-light-grey","tw-mt-2",3,"ngClass"],["type","password","required","","formControlName","newPassword","placeholder","New Password",1,"form-control","!tw-bg-grey","tw-rounded-md","placeholder:tw-text-light-grey","tw-my-4",3,"ngClass"],["type","password","required","","formControlName","confirmNewPassword","placeholder","Confirm new password",1,"form-control","!tw-bg-grey","tw-rounded-md","placeholder:tw-text-light-grey",3,"ngClass"],["class","!tw-my-4",4,"ngIf"],[1,"tw-flex","tw-justify-center","tw-mt-2"],[1,"btn","tw-bg-red","tw-border-none","tw-text-white","hover:tw-border-solid","hover:tw-border-red",3,"click"],[1,"tw-flex","tw-justify-center","tw-gap-4"],[1,"btn","btn-sm","btn-primary",3,"click","ngClass"],[1,"text-primary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"tw-flex","tw-justify-center"],[1,"btn","btn-sm","btn-primary","tw-my-2",3,"click"],[1,"!tw-my-4","text-danger","tw-text-center"],[1,"!tw-my-4","text-success","tw-text-center"],[1,"!tw-my-4"]],template:function(a,t){a&1&&(r(0,"div",0)(1,"div",1)(2,"h4",2),o(3,"Personal Informations"),i(),r(4,"div")(5,"span",3),o(6,"Username:"),i(),o(7),i(),r(8,"div",4)(9,"span",3),o(10,"Email:"),i(),o(11),i(),r(12,"div")(13,"span",3),o(14,"Member since:"),i(),o(15),G(16,"date"),i(),r(17,"div",5)(18,"div",6)(19,"div",7),f(20,"img",8)(21,"img",9),i(),m(22,Pe,11,9)(23,ye,5,0),i()()(),r(24,"div",1)(25,"h4",2),o(26,"Settings"),i(),r(27,"mat-accordion")(28,"mat-expansion-panel",10)(29,"mat-expansion-panel-header")(30,"mat-panel-title"),o(31,"Update Username"),i()(),r(32,"div",11)(33,"ul")(34,"li"),o(35,"Updating your username is a premium feature, and can only be done once a month."),i(),r(36,"li"),o(37,"Users who signed-in with Google can update their username once."),i()(),r(38,"form",12),c("ngSubmit",function(){return t.submitUpdateUsername()}),f(39,"input",13),r(40,"div",11),m(41,Se,2,1,"p",14)(42,Ee,2,1,"p",15),r(43,"div",4)(44,"button",16),o(45," Update"),m(46,Me,1,0,"span",17),i()()()()()(),r(47,"mat-expansion-panel",10)(48,"mat-expansion-panel-header")(49,"mat-panel-title"),o(50,"Update Password"),i()(),r(51,"div",11)(52,"form",12),c("ngSubmit",function(){return t.submitUpdatePassword()}),f(53,"input",18)(54,"input",19)(55,"input",20),r(56,"div",11),m(57,Fe,2,0,"p",21)(58,Ie,2,1,"p",14)(59,ke,2,1,"p",15),r(60,"div",4)(61,"button",16),o(62," Update"),m(63,Te,1,0,"span",17),i()()()()()(),r(64,"mat-expansion-panel",10)(65,"mat-expansion-panel-header")(66,"mat-panel-title"),o(67,"Delete Account"),i()(),r(68,"div",22)(69,"button",23),c("click",function(){return t.openDeleteDialog()}),o(70," Delete my account"),m(71,De,1,0,"span",17),i()()()()()()),a&2&&(s(7),y(" ",t.user==null?null:t.user.username,""),s(4),y(" ",t.user==null?null:t.user.email,""),s(4),y(" ",O(16,21,t.user==null?null:t.user.createdAt,"MM-dd-YYYY"),""),s(7),I(t.user!=null&&t.user.patreonAccount?22:23),s(16),l("formGroup",t.usernameForm),s(),l("placeholder",t.user==null?null:t.user.username)("ngClass",h(24,F,t.usernameForm.get("username")&&t.usernameForm.get("username").invalid&&(t.usernameForm.get("username").dirty||t.usernameForm.get("username").touched))),s(2),l("ngIf",t.errorMessage),s(),l("ngIf",t.successMessage),s(2),l("disabled",t.usernameForm.invalid||(t.usernameForm.errors==null?null:t.usernameForm.errors.passwordMismatch)),s(2),l("ngIf",t.loading),s(6),l("formGroup",t.passwordForm),s(),l("ngClass",h(26,F,t.passwordForm.get("currentPassword")&&t.passwordForm.get("currentPassword").invalid&&(t.passwordForm.get("currentPassword").dirty||t.passwordForm.get("currentPassword").touched))),s(),l("ngClass",h(28,F,t.passwordForm.get("newPassword")&&t.passwordForm.get("newPassword").invalid&&(t.passwordForm.get("newPassword").dirty||t.passwordForm.get("newPassword").touched))),s(),l("ngClass",h(30,F,t.passwordForm.get("confirmNewPassword")&&t.passwordForm.get("confirmNewPassword").invalid&&(t.passwordForm.get("confirmNewPassword").dirty||t.passwordForm.get("confirmNewPassword").touched))),s(2),l("ngIf",t.passwordForm.errors==null?null:t.passwordForm.errors.passwordMismatch),s(),l("ngIf",t.errorMessage),s(),l("ngIf",t.successMessage),s(2),l("disabled",t.passwordForm.invalid||(t.passwordForm.errors==null?null:t.passwordForm.errors.passwordMismatch)),s(2),l("ngIf",t.loading),s(8),l("ngIf",t.loading))},dependencies:[q,S,se,ie,re,oe,X,z,W,J,ee,Z,Q,B],encapsulation:2})}return e})();var Ue=[{path:"",component:ue}],Ze=(()=>{class e{static \u0275fac=function(a){return new(a||e)};static \u0275mod=R({type:e});static \u0275inj=N({imports:[Y,L.forChild(Ue),ae]})}return e})();export{Ze as ProfileModule};
