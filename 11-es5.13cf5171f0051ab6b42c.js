!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function n(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{VTKI:function(e,o,s){"use strict";s.r(o),s.d(o,"LobbyModule",(function(){return yt}));var i,b,c,r=s("ofXK"),a=s("fXoL"),u=s("3Pt+"),l=s("XYSw"),p=s("eLK+"),y=s("wFdA"),f=s("tyNb"),h=s("l7P3"),d=((b=function(){function e(n,o,s,i,b){t(this,e),this.fb=n,this.lobbyHttpService=o,this.router=s,this.route=i,this.store=b,this.userCanEdit=!0,this.subscriptions=[]}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.lobbyForm=this.fb.group({name:["",u.s.required.bind(this)],password:[""]}),this.create||this.subscriptions.push(this.store.select("lobby").subscribe((function(e){t.lobby=e.lobby,t.lobbyForm.controls.name.setValue(t.lobby.name),t.lobbyForm.controls.password.setValue(t.lobby.password),t.userCanEdit=e.role===p.b.Host,t.userCanEdit?t.lobbyForm.enable():t.lobbyForm.disable()})))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(t){return t.unsubscribe()}))}},{key:"submit",value:function(){var t=this;this.create?this.lobbyHttpService.create(new l.a({name:this.lobbyForm.get("name").value,password:this.lobbyForm.get("password").value})).subscribe((function(e){t.router.navigate(["/lobby/"+e.code])})):this.lobbyHttpService.update(this.lobby.code,new l.a({name:this.lobbyForm.get("name").value,password:this.lobbyForm.get("password").value})).subscribe((function(t){console.log(t)}))}}]),e}()).\u0275fac=function(t){return new(t||b)(a.Jb(u.c),a.Jb(y.a),a.Jb(f.b),a.Jb(f.a),a.Jb(h.h))},b.\u0275cmp=a.Db({type:b,selectors:[["app-lobby-config"]],inputs:{create:"create"},decls:5,vars:2,consts:[[3,"formGroup","ngSubmit"],["type","text","formControlName","name","placeholder","Room name","required","required"],["type","text","formControlName","password","placeholder","Password (keep empty if public)"],["type","submit"]],template:function(t,e){1&t&&(a.Ob(0,"form",0),a.Vb("ngSubmit",(function(){return!e.userCanEdit||e.submit()})),a.Kb(1,"input",1),a.Kb(2,"input",2),a.Ob(3,"button",3),a.yc(4),a.Nb(),a.Nb()),2&t&&(a.gc("formGroup",e.lobbyForm),a.zb(4),a.zc(e.create?"Create":"Save"))},directives:[u.t,u.n,u.h,u.b,u.m,u.f,u.r],encapsulation:2}),b),v=((i=function(){function e(){t(this,e)}return n(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=a.Db({type:i,selectors:[["app-create"]],decls:1,vars:1,consts:[[3,"create"]],template:function(t,e){1&t&&a.Kb(0,"app-lobby-config",0),2&t&&a.gc("create",!0)},directives:[d],encapsulation:2}),i),m=s("PCNd"),g=s("mDxo"),w=s("f7Zi"),S=s("2Vo4"),O=s("AytR"),k=((c=function(){function e(n){t(this,e),this.store=n,this.subject=new S.a([])}return n(e,[{key:"on",value:function(){return this.subject.asObservable()}},{key:"joinLobby",value:function(t){var e=this;if(void 0===this.eventSource){var n=new URL(O.a.mercureEndpoint);n.searchParams.append("topic","".concat(O.a.apiEndpoint,"/lobbies/").concat(t.code)),n.searchParams.append("topic","/.well-known/mercure/subscriptions/".concat(O.a.apiEndpoint,"/lobbies/").concat(t.code,"{/subscriber}")),this.eventSource=new EventSource(n.toString(),{withCredentials:!0}),this.eventSource.onopen=function(t){console.log(t)},this.eventSource.onmessage=function(t){console.log(t)},this.eventSource.addEventListener("configUpdated",(function(t){e.store.dispatch(Object(g.d)({lobby:new l.a(JSON.parse(t.data))}))})),this.eventSource.addEventListener("updateLobbyUsers",(function(t){var n=JSON.parse(t.data);Array.isArray(n)&&e.store.dispatch(Object(g.f)({lobbyUsers:n.map((function(t){return new p.a(t)}))}))})),this.eventSource.addEventListener("updateLobbyStatus",(function(t){e.store.dispatch(Object(g.e)({status:t.data}))})),this.eventSource.addEventListener("updateLobby",(function(t){console.log(JSON.parse(t.data)),e.store.dispatch(Object(g.d)({lobby:new l.a(JSON.parse(t.data))}))})),this.eventSource.addEventListener("availableGameChoices",(function(t){e.store.dispatch(Object(g.c)({gameNames:JSON.parse(t.data)}))})),this.eventSource.onerror=function(t){console.log(t)}}}},{key:"disconnect",value:function(){this.eventSource.close(),this.eventSource=void 0}}]),e}()).\u0275fac=function(t){return new(t||c)(a.Sb(h.h))},c.\u0275prov=a.Fb({token:c,factory:c.\u0275fac,providedIn:"root"}),c),C=s("0IaG"),L=s("ipG3");function I(t,e){1&t&&(a.Mb(0),a.yc(1,"gg"),a.Lb())}function N(t,e){1&t&&a.Kb(0,"i",4)}function J(t,e){if(1&t&&(a.Ob(0,"span"),a.yc(1),a.Nb()),2&t){var n=a.Zb().$implicit;a.zb(1),a.zc(n.points)}}function E(t,e){if(1&t&&(a.Ob(0,"span"),a.yc(1),a.Nb()),2&t){var n=a.Zb().$implicit;a.zb(1),a.Ac("-> ",n.answer,"")}}function j(t,e){if(1&t&&(a.Ob(0,"div"),a.Ob(1,"span",2),a.wc(2,N,1,0,"i",3),a.wc(3,J,2,1,"span",0),a.yc(4),a.wc(5,E,2,1,"span",0),a.Nb(),a.Nb()),2&t){var n=e.$implicit,o=a.Zb();a.zb(1),a.gc("ngClass",o.getStatusClass(n)),a.zb(1),a.gc("ngIf",n.role===o.lobbyUserRoles.Host),a.zb(1),a.gc("ngIf",o.lobbyStatus!==o.lobbyStatuses.Waiting),a.zb(1),a.Ac(" ",n.user.username," "),a.zb(1),a.gc("ngIf",n.answer)}}var z,F=((z=function(){function e(n){t(this,e),this.store=n,this.showRank=!1,this.lobbyStatuses=l.c,this.lobbyUserRoles=p.b}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select(L.e).subscribe((function(e){t.users=e})),this.store.select(L.d).subscribe((function(e){t.lobbyStatus=e}))}},{key:"getStatusClass",value:function(t){return t.disconnected?"text-muted":t.status===p.c.WrongAnswer?"text-danger":t.status===p.c.CorrectAnswer?"text-success":t.answered?"text-primary":void 0}}]),e}()).\u0275fac=function(t){return new(t||z)(a.Jb(h.h))},z.\u0275cmp=a.Db({type:z,selectors:[["app-lobby-users"]],inputs:{showRank:"showRank"},decls:3,vars:2,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngClass"],["class","fa fa-star mr-1",4,"ngIf"],[1,"fa","fa-star","mr-1"]],template:function(t,e){1&t&&(a.Mb(0),a.wc(1,I,2,0,"ng-container",0),a.wc(2,j,6,5,"div",1),a.Lb()),2&t&&(a.zb(1),a.gc("ngIf",e.showRank),a.zb(1),a.gc("ngForOf",e.users))},directives:[r.l,r.k,r.j],encapsulation:2}),z);function A(t,e){1&t&&(a.Mb(0),a.yc(1,"(loading)"),a.Lb())}function K(t,e){if(1&t){var n=a.Pb();a.Mb(0),a.Ob(1,"button",1),a.Vb("click",(function(){return a.nc(n),a.Zb().play()})),a.yc(2,"Play "),a.wc(3,A,2,0,"ng-container",0),a.Nb(),a.Lb()}if(2&t){var o=a.Zb();a.zb(3),a.gc("ngIf",o.lobby.status===o.lobbyStatus.Loading)}}function M(t,e){1&t&&(a.Mb(0),a.yc(1,"(loading)"),a.Lb())}function R(t,e){if(1&t&&(a.Mb(0),a.Ob(1,"button",2),a.yc(2,"Ready "),a.wc(3,M,2,0,"ng-container",0),a.Nb(),a.Lb()),2&t){var n=a.Zb();a.zb(3),a.gc("ngIf",n.lobby.status===n.lobbyStatus.Loading)}}var D,H,P,x,U=((P=function(){function e(n,o){t(this,e),this.lobbyHttpService=n,this.store=o,this.lobbyUsersRoles=p.b,this.lobbyStatus=l.c,this.subscriptions=[]}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.subscriptions.push(this.store.select("lobby").subscribe((function(e){t.lobby=e.lobby,t.role=e.role,console.log(t.role)})))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(t){return t.unsubscribe()}))}},{key:"play",value:function(){this.lobbyHttpService.play(this.lobby.code).subscribe((function(){}))}}]),e}()).\u0275fac=function(t){return new(t||P)(a.Jb(y.a),a.Jb(h.h))},P.\u0275cmp=a.Db({type:P,selectors:[["app-button-play"]],decls:2,vars:2,consts:[[4,"ngIf"],["type","button",3,"click"],["type","button"]],template:function(t,e){1&t&&(a.wc(0,K,4,1,"ng-container",0),a.wc(1,R,4,1,"ng-container",0)),2&t&&(a.gc("ngIf",e.role===e.lobbyUsersRoles.Host),a.zb(1),a.gc("ngIf",e.role===e.lobbyUsersRoles.Player))},directives:[r.l],encapsulation:2}),P),V=((H=function e(){t(this,e)}).\u0275fac=function(t){return new(t||H)},H.\u0275cmp=a.Db({type:H,selectors:[["app-lobby-waiting"]],decls:2,vars:0,template:function(t,e){1&t&&(a.Kb(0,"app-lobby-config"),a.Kb(1,"app-button-play"))},directives:[d,U],encapsulation:2}),H),Z=((D=function(){function e(n){t(this,e),this.store=n}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select("lobby").subscribe((function(e){var n;void 0!==t.lobby&&t.lobby.status!==e.lobby.status&&(void 0!==e.lobby.currentMusic?(void 0!==t.audio&&t.audio.pause(),t.audio=new Audio,t.audio.src=e.lobby.currentMusic.music.awsUrl,t.audio.volume=.1,t.audio.currentTime=e.lobby.currentMusic.startAt,t.audio.play()):null===(n=t.audio)||void 0===n||n.pause()),t.lobby=e.lobby}))}},{key:"ngOnDestroy",value:function(){var t;null===(t=this.audio)||void 0===t||t.pause()}}]),e}()).\u0275fac=function(t){return new(t||D)(a.Jb(h.h))},D.\u0275cmp=a.Db({type:D,selectors:[["app-lobby-audio-player"]],decls:2,vars:0,template:function(t,e){1&t&&(a.Ob(0,"p"),a.yc(1,"audio-player works!"),a.Nb())},encapsulation:2}),D),G=s("PqYM"),T=s("IzEk"),q=s("lJxs"),X=((x=function(){function e(n){t(this,e),this.store=n}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select("lobby").subscribe((function(e){void 0!==t.lobby&&t.lobby.status!==e.lobby.status&&(t.guessTime=e.lobby.guessTime,t.counter=Object(G.a)(0,1e3).pipe(Object(T.a)(t.guessTime),Object(q.a)((function(){return--t.guessTime})))),t.lobby=e.lobby}))}}]),e}()).\u0275fac=function(t){return new(t||x)(a.Jb(h.h))},x.\u0275cmp=a.Db({type:x,selectors:[["app-lobby-countdown"]],decls:2,vars:3,template:function(t,e){1&t&&(a.yc(0),a.ac(1,"async")),2&t&&a.Ac("",a.bc(1,1,e.counter),"\n")},pipes:[r.b],encapsulation:2}),x),$=s("JX91"),W=s("kmnG"),Y=s("qFsG"),B=s("/1cH"),Q=s("FKr1");function _(t,e){if(1&t&&(a.Ob(0,"mat-option",5),a.yc(1),a.Nb()),2&t){var n=e.$implicit;a.gc("value",n),a.zb(1),a.Ac(" ",n," ")}}var tt,et,nt,ot=((nt=function(){function e(n,o){t(this,e),this.store=n,this.lobbyHttpService=o,this.myControl=new u.d,this.gameNames=[],this.lobbyStatuses=l.c}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select(L.b).subscribe((function(e){e&&(t.gameNames=e)})),this.store.select(L.c).subscribe((function(e){void 0!==t.lobby&&t.lobby.status!==e.status&&(e.status===l.c.AnswerReveal?t.myControl.disable():(t.myControl.enable(),t.myControl.setValue(""))),t.lobby=e})),this.filteredOptions=this.myControl.valueChanges.pipe(Object($.a)(""),Object(q.a)((function(e){return t.filter(null===e?"":e)})))}},{key:"submit",value:function(){this.lobbyHttpService.answer(this.lobby.code,this.myControl.value).subscribe((function(){}))}},{key:"filter",value:function(t){var e=t.toLowerCase();return this.gameNames.filter((function(t){return t.toLowerCase().includes(e)}))}}]),e}()).\u0275fac=function(t){return new(t||nt)(a.Jb(h.h),a.Jb(y.a))},nt.\u0275cmp=a.Db({type:nt,selectors:[["app-lobby-answer"]],decls:8,vars:9,consts:[[3,"ngSubmit"],[2,"width","100%"],["type","text","placeholder","Pick one","aria-label","Number","matInput","",3,"formControl","matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){if(1&t&&(a.Ob(0,"form",0),a.Vb("ngSubmit",(function(){return e.lobby.status===e.lobbyStatuses.AnswerReveal||e.submit()})),a.Ob(1,"mat-form-field",1),a.Kb(2,"input",2),a.Ob(3,"mat-autocomplete",null,3),a.wc(5,_,2,2,"mat-option",4),a.ac(6,"slice"),a.ac(7,"async"),a.Nb(),a.Nb(),a.Nb()),2&t){var n=a.mc(4);a.zb(2),a.gc("formControl",e.myControl)("matAutocomplete",n),a.zb(3),a.gc("ngForOf",a.dc(6,3,a.bc(7,7,e.filteredOptions),0,30))}},directives:[u.t,u.n,u.o,W.b,Y.a,u.b,B.c,u.m,u.e,B.a,r.k,Q.f],pipes:[r.q,r.b],encapsulation:2}),nt),st=((et=function(){function e(n){t(this,e),this.store=n}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select("lobby").subscribe((function(e){t.lobby=e.lobby}))}}]),e}()).\u0275fac=function(t){return new(t||et)(a.Jb(h.h))},et.\u0275cmp=a.Db({type:et,selectors:[["app-lobby-center-container"]],decls:4,vars:1,template:function(t,e){1&t&&(a.yc(0),a.Kb(1,"app-lobby-audio-player"),a.Kb(2,"app-lobby-countdown"),a.Kb(3,"app-lobby-answer")),2&t&&a.Ac("",null==e.lobby||null==e.lobby.currentMusic||null==e.lobby.currentMusic.expectedAnswer?null:e.lobby.currentMusic.expectedAnswer.name," ")},directives:[Z,X,ot],encapsulation:2}),et),it=((tt=function e(){t(this,e)}).\u0275fac=function(t){return new(t||tt)},tt.\u0275cmp=a.Db({type:tt,selectors:[["app-lobby-playing"]],decls:1,vars:0,template:function(t,e){1&t&&a.Kb(0,"app-lobby-center-container")},directives:[st],encapsulation:2}),tt);function bt(t,e){1&t&&(a.Mb(0),a.Kb(1,"app-lobby-waiting"),a.Lb())}function ct(t,e){1&t&&(a.Mb(0),a.Kb(1,"app-lobby-playing"),a.Lb())}function rt(t,e){if(1&t){var n=a.Pb();a.Mb(0),a.Ob(1,"button",2),a.Vb("click",(function(){return a.nc(n),a.Zb().leave()})),a.yc(2,"Leave"),a.Nb(),a.wc(3,bt,2,0,"ng-container",3),a.wc(4,ct,2,0,"ng-container",3),a.Kb(5,"app-lobby-users",4),a.Lb()}if(2&t){var o=a.Zb();a.zb(3),a.gc("ngIf",o.lobby.isWaiting()),a.zb(1),a.gc("ngIf",o.lobby.isPLaying()),a.zb(1),a.gc("showRank",o.lobby.isFinalStanding())}}function at(t,e){1&t&&a.yc(0,"loading")}var ut,lt,pt=[{path:"create",component:v},{path:":code",component:(ut=function(){function e(n,o,s,i,b,c){t(this,e),this.lobbyHttpService=n,this.router=o,this.route=s,this.lobbyEventSourceService=i,this.store=b,this.dialog=c,this.lobbyStatuses=l.c,this.subscriptions=[]}return n(e,[{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(t){return t.unsubscribe()})),this.store.dispatch(Object(g.a)()),this.lobbyEventSourceService.disconnect()}},{key:"ngOnInit",value:function(){var t=this;this.subscriptions.push(this.store.select("lobby").subscribe((function(e){e.lobby?(t.lobby=e.lobby,t.lobbyEventSourceService.joinLobby(t.lobby)):(t.route.paramMap.subscribe((function(e){t.lobbyCode=e.get("code")})),t.lobbyHttpService.join(t.lobbyCode).subscribe((function(e){t.dispatchLobby(e)}),(function(e){401===e.status&&t.dialog.open(w.a,{data:t.lobbyCode}).afterClosed().subscribe((function(e){e instanceof l.b?t.dispatchLobby(e):t.router.navigate(["/"])}))})))})))}},{key:"leave",value:function(){var t=this;this.lobbyHttpService.leave(this.lobbyCode).subscribe((function(){t.router.navigate(["/"]),t.store.dispatch(Object(g.a)())}))}},{key:"dispatchLobby",value:function(t){this.lobby=t.lobby,this.lobbyEventSourceService.joinLobby(this.lobby),this.store.dispatch(Object(g.b)({lobby:this.lobby,role:t.role,gameNames:t.gameNames}))}}]),e}(),ut.\u0275fac=function(t){return new(t||ut)(a.Jb(y.a),a.Jb(f.b),a.Jb(f.a),a.Jb(k),a.Jb(h.h),a.Jb(C.b))},ut.\u0275cmp=a.Db({type:ut,selectors:[["app-lobby"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],["type","button",1,"btn","btn-primary-reverse",3,"click"],[4,"ngIf"],[3,"showRank"]],template:function(t,e){if(1&t&&(a.wc(0,rt,6,3,"ng-container",0),a.wc(1,at,1,0,"ng-template",null,1,a.xc)),2&t){var n=a.mc(2);a.gc("ngIf",e.lobby)("ngIfElse",n)}},directives:[r.l,F,V,it],encapsulation:2}),ut)},{path:"**",redirectTo:"create"}],yt=((lt=function e(){t(this,e)}).\u0275mod=a.Hb({type:lt}),lt.\u0275inj=a.Gb({factory:function(t){return new(t||lt)},providers:[y.a,k],imports:[[r.c,f.f.forChild(pt),m.a]]}),lt)}}])}();