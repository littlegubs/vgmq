!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function n(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{VTKI:function(e,o,s){"use strict";s.r(o),s.d(o,"LobbyModule",(function(){return dt}));var i,b,c,r=s("ofXK"),a=s("fXoL"),u=s("3Pt+"),l=s("XYSw"),p=s("eLK+"),f=s("wFdA"),y=s("tyNb"),d=s("l7P3"),h=((b=function(){function e(n,o,s,i,b){t(this,e),this.fb=n,this.lobbyHttpService=o,this.router=s,this.route=i,this.store=b,this.userCanEdit=!0,this.subscriptions=[]}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.lobbyForm=this.fb.group({name:["",u.s.required.bind(this)],password:[""]}),this.create||this.subscriptions.push(this.store.select("lobby").subscribe((function(e){t.lobby=e.lobby,t.lobbyForm.controls.name.setValue(t.lobby.name),t.lobbyForm.controls.password.setValue(t.lobby.password),t.userCanEdit=e.role===p.b.Host,t.userCanEdit?t.lobbyForm.enable():t.lobbyForm.disable()})))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(t){return t.unsubscribe()}))}},{key:"submit",value:function(){var t=this;this.create?this.lobbyHttpService.create(new l.a({name:this.lobbyForm.get("name").value,password:this.lobbyForm.get("password").value})).subscribe((function(e){t.router.navigate(["/lobby/"+e.code])})):this.lobbyHttpService.update(this.lobby.code,new l.a({name:this.lobbyForm.get("name").value,password:this.lobbyForm.get("password").value})).subscribe((function(t){console.log(t)}))}}]),e}()).\u0275fac=function(t){return new(t||b)(a.Jb(u.c),a.Jb(f.a),a.Jb(y.b),a.Jb(y.a),a.Jb(d.h))},b.\u0275cmp=a.Db({type:b,selectors:[["app-lobby-config"]],inputs:{create:"create"},decls:5,vars:2,consts:[[3,"formGroup","ngSubmit"],["type","text","formControlName","name","placeholder","Room name","required","required"],["type","text","formControlName","password","placeholder","Password (keep empty if public)"],["type","submit"]],template:function(t,e){1&t&&(a.Ob(0,"form",0),a.Vb("ngSubmit",(function(){return!e.userCanEdit||e.submit()})),a.Kb(1,"input",1),a.Kb(2,"input",2),a.Ob(3,"button",3),a.yc(4),a.Nb(),a.Nb()),2&t&&(a.gc("formGroup",e.lobbyForm),a.zb(4),a.zc(e.create?"Create":"Save"))},directives:[u.t,u.n,u.h,u.b,u.m,u.f,u.r],encapsulation:2}),b),v=((i=function(){function e(){t(this,e)}return n(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=a.Db({type:i,selectors:[["app-create"]],decls:1,vars:1,consts:[[3,"create"]],template:function(t,e){1&t&&a.Kb(0,"app-lobby-config",0),2&t&&a.gc("create",!0)},directives:[h],encapsulation:2}),i),m=s("PCNd"),g=s("mDxo"),w=s("f7Zi"),S=s("2Vo4"),O=s("AytR"),k=((c=function(){function e(n){t(this,e),this.store=n,this.subject=new S.a([])}return n(e,[{key:"on",value:function(){return this.subject.asObservable()}},{key:"joinLobby",value:function(t){var e=this;if(void 0===this.eventSource){var n=new URL(O.a.mercureEndpoint);n.searchParams.append("topic","".concat(O.a.apiEndpoint,"/lobbies/").concat(t.code)),n.searchParams.append("topic","/.well-known/mercure/subscriptions/".concat(O.a.apiEndpoint,"/lobbies/").concat(t.code,"{/subscriber}")),this.eventSource=new EventSource(n.toString(),{withCredentials:!0}),this.eventSource.onopen=function(t){console.log(t)},this.eventSource.onmessage=function(t){console.log(t)},this.eventSource.addEventListener("configUpdated",(function(t){e.store.dispatch(Object(g.d)({lobby:new l.a(JSON.parse(t.data))}))})),this.eventSource.addEventListener("updateLobbyUsers",(function(t){var n=JSON.parse(t.data);Array.isArray(n)&&e.store.dispatch(Object(g.f)({lobbyUsers:n.map((function(t){return new p.a(t)}))}))})),this.eventSource.addEventListener("updateLobbyStatus",(function(t){e.store.dispatch(Object(g.e)({status:t.data}))})),this.eventSource.addEventListener("updateLobby",(function(t){e.store.dispatch(Object(g.d)({lobby:new l.a(JSON.parse(t.data))}))})),this.eventSource.addEventListener("availableGameChoices",(function(t){e.store.dispatch(Object(g.c)({gameNames:JSON.parse(t.data)}))})),this.eventSource.onerror=function(t){console.log(t)}}}},{key:"disconnect",value:function(){this.eventSource.close(),this.eventSource=void 0}}]),e}()).\u0275fac=function(t){return new(t||c)(a.Sb(d.h))},c.\u0275prov=a.Fb({token:c,factory:c.\u0275fac,providedIn:"root"}),c),I=s("0IaG"),C=s("ipG3"),L=function(t){return{"text-warning":t}};function N(t,e){if(1&t&&(a.Ob(0,"div"),a.Ob(1,"span",3),a.yc(2),a.Nb(),a.Nb()),2&t){var n=e.$implicit,o=a.Zb(2);a.zb(1),a.gc("ngClass",a.jc(2,L,n.role===o.lobbyUserRoles.Host)),a.zb(1),a.Ac(" ",n.user.username," ")}}function J(t,e){if(1&t&&(a.Mb(0),a.wc(1,N,3,4,"div",2),a.Lb()),2&t){var n=a.Zb();a.zb(1),a.gc("ngForOf",n.users)}}function E(t,e){if(1&t&&(a.Ob(0,"span"),a.yc(1),a.Nb()),2&t){var n=a.Zb().$implicit;a.zb(1),a.Ac("-> ",n.answer,"")}}var j=function(t){return{"text-primary":t}};function F(t,e){if(1&t&&(a.Ob(0,"div"),a.Ob(1,"span",3),a.yc(2),a.wc(3,E,2,1,"span",4),a.Nb(),a.Nb()),2&t){var n=e.$implicit;a.zb(1),a.gc("ngClass",a.jc(3,j,n.answered)),a.zb(1),a.Ac(" ",n.user.username," "),a.zb(1),a.gc("ngIf",n.answer)}}function A(t,e){if(1&t&&a.wc(0,F,4,5,"div",2),2&t){var n=a.Zb();a.gc("ngForOf",n.users)}}var z,K=((z=function(){function e(n){t(this,e),this.store=n,this.lobbyStatuses=l.c,this.lobbyUserRoles=p.b}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select(C.e).subscribe((function(e){t.users=e})),this.store.select(C.d).subscribe((function(e){t.lobbyStatus=e}))}}]),e}()).\u0275fac=function(t){return new(t||z)(a.Jb(d.h))},z.\u0275cmp=a.Db({type:z,selectors:[["app-lobby-users"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["playingUsers",""],[4,"ngFor","ngForOf"],[3,"ngClass"],[4,"ngIf"]],template:function(t,e){if(1&t&&(a.wc(0,J,2,1,"ng-container",0),a.wc(1,A,1,1,"ng-template",null,1,a.xc)),2&t){var n=a.mc(2);a.gc("ngIf",e.lobbyStatus===e.lobbyStatuses.Waiting)("ngIfElse",n)}},directives:[r.l,r.k,r.j],encapsulation:2}),z);function M(t,e){1&t&&(a.Mb(0),a.yc(1,"(loading)"),a.Lb())}function D(t,e){if(1&t){var n=a.Pb();a.Mb(0),a.Ob(1,"button",1),a.Vb("click",(function(){return a.nc(n),a.Zb().play()})),a.yc(2,"Play "),a.wc(3,M,2,0,"ng-container",0),a.Nb(),a.Lb()}if(2&t){var o=a.Zb();a.zb(3),a.gc("ngIf",o.lobby.status===o.lobbyStatus.Loading)}}function H(t,e){1&t&&(a.Mb(0),a.yc(1,"(loading)"),a.Lb())}function P(t,e){if(1&t&&(a.Mb(0),a.Ob(1,"button",2),a.yc(2,"Ready "),a.wc(3,H,2,0,"ng-container",0),a.Nb(),a.Lb()),2&t){var n=a.Zb();a.zb(3),a.gc("ngIf",n.lobby.status===n.lobbyStatus.Loading)}}var x,R,U,Z,G=((U=function(){function e(n,o){t(this,e),this.lobbyHttpService=n,this.store=o,this.lobbyUsersRoles=p.b,this.lobbyStatus=l.c,this.subscriptions=[]}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.subscriptions.push(this.store.select("lobby").subscribe((function(e){t.lobby=e.lobby,t.role=e.role,console.log(t.role)})))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(t){return t.unsubscribe()}))}},{key:"play",value:function(){this.lobbyHttpService.play(this.lobby.code).subscribe((function(){}))}}]),e}()).\u0275fac=function(t){return new(t||U)(a.Jb(f.a),a.Jb(d.h))},U.\u0275cmp=a.Db({type:U,selectors:[["app-button-play"]],decls:2,vars:2,consts:[[4,"ngIf"],["type","button",3,"click"],["type","button"]],template:function(t,e){1&t&&(a.wc(0,D,4,1,"ng-container",0),a.wc(1,P,4,1,"ng-container",0)),2&t&&(a.gc("ngIf",e.role===e.lobbyUsersRoles.Host),a.zb(1),a.gc("ngIf",e.role===e.lobbyUsersRoles.Player))},directives:[r.l],encapsulation:2}),U),T=((R=function e(){t(this,e)}).\u0275fac=function(t){return new(t||R)},R.\u0275cmp=a.Db({type:R,selectors:[["app-lobby-waiting"]],decls:2,vars:0,template:function(t,e){1&t&&(a.Kb(0,"app-lobby-config"),a.Kb(1,"app-button-play"))},directives:[h,G],encapsulation:2}),R),V=((x=function(){function e(n){t(this,e),this.store=n}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select("lobby").subscribe((function(e){var n;void 0!==t.lobby&&t.lobby.status!==e.lobby.status&&(void 0!==e.lobby.currentMusic?(void 0!==t.audio&&t.audio.pause(),t.audio=new Audio,t.audio.src=e.lobby.currentMusic.music.awsUrl,t.audio.volume=.1,t.audio.currentTime=e.lobby.currentMusic.startAt,t.audio.play()):null===(n=t.audio)||void 0===n||n.pause()),t.lobby=e.lobby}))}},{key:"ngOnDestroy",value:function(){var t;null===(t=this.audio)||void 0===t||t.pause()}}]),e}()).\u0275fac=function(t){return new(t||x)(a.Jb(d.h))},x.\u0275cmp=a.Db({type:x,selectors:[["app-lobby-audio-player"]],decls:2,vars:0,template:function(t,e){1&t&&(a.Ob(0,"p"),a.yc(1,"audio-player works!"),a.Nb())},encapsulation:2}),x),q=s("PqYM"),X=s("IzEk"),$=s("lJxs"),W=((Z=function(){function e(n){t(this,e),this.store=n}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select("lobby").subscribe((function(e){void 0!==t.lobby&&t.lobby.status!==e.lobby.status&&(t.guessTime=e.lobby.guessTime,t.counter=Object(q.a)(0,1e3).pipe(Object(X.a)(t.guessTime),Object($.a)((function(){return--t.guessTime})))),t.lobby=e.lobby}))}}]),e}()).\u0275fac=function(t){return new(t||Z)(a.Jb(d.h))},Z.\u0275cmp=a.Db({type:Z,selectors:[["app-lobby-countdown"]],decls:2,vars:3,template:function(t,e){1&t&&(a.yc(0),a.ac(1,"async")),2&t&&a.Ac("",a.bc(1,1,e.counter),"\n")},pipes:[r.b],encapsulation:2}),Z),Y=s("JX91"),B=s("kmnG"),Q=s("qFsG"),_=s("/1cH"),tt=s("FKr1");function et(t,e){if(1&t&&(a.Ob(0,"mat-option",5),a.yc(1),a.Nb()),2&t){var n=e.$implicit;a.gc("value",n),a.zb(1),a.Ac(" ",n," ")}}var nt,ot,st,it=((st=function(){function e(n,o){t(this,e),this.store=n,this.lobbyHttpService=o,this.myControl=new u.d,this.gameNames=[],this.lobbyStatuses=l.c}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select(C.b).subscribe((function(e){e&&(t.gameNames=e)})),this.store.select(C.c).subscribe((function(e){void 0!==t.lobby&&t.lobby.status!==e.status&&(e.status===l.c.AnswerReveal?t.myControl.disable():(t.myControl.enable(),t.myControl.setValue(""))),t.lobby=e})),this.filteredOptions=this.myControl.valueChanges.pipe(Object(Y.a)(""),Object($.a)((function(e){return t.filter(null===e?"":e)})))}},{key:"submit",value:function(){this.lobbyHttpService.answer(this.lobby.code,this.myControl.value).subscribe((function(){}))}},{key:"filter",value:function(t){var e=t.toLowerCase();return this.gameNames.filter((function(t){return t.toLowerCase().includes(e)}))}}]),e}()).\u0275fac=function(t){return new(t||st)(a.Jb(d.h),a.Jb(f.a))},st.\u0275cmp=a.Db({type:st,selectors:[["app-lobby-answer"]],decls:8,vars:9,consts:[[3,"ngSubmit"],[2,"width","100%"],["type","text","placeholder","Pick one","aria-label","Number","matInput","",3,"formControl","matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){if(1&t&&(a.Ob(0,"form",0),a.Vb("ngSubmit",(function(){return e.lobby.status===e.lobbyStatuses.AnswerReveal||e.submit()})),a.Ob(1,"mat-form-field",1),a.Kb(2,"input",2),a.Ob(3,"mat-autocomplete",null,3),a.wc(5,et,2,2,"mat-option",4),a.ac(6,"slice"),a.ac(7,"async"),a.Nb(),a.Nb(),a.Nb()),2&t){var n=a.mc(4);a.zb(2),a.gc("formControl",e.myControl)("matAutocomplete",n),a.zb(3),a.gc("ngForOf",a.dc(6,3,a.bc(7,7,e.filteredOptions),0,30))}},directives:[u.t,u.n,u.o,B.b,Q.a,u.b,_.c,u.m,u.e,_.a,r.k,tt.f],pipes:[r.q,r.b],encapsulation:2}),st),bt=((ot=function(){function e(n){t(this,e),this.store=n}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.store.select("lobby").subscribe((function(e){t.lobby=e.lobby}))}}]),e}()).\u0275fac=function(t){return new(t||ot)(a.Jb(d.h))},ot.\u0275cmp=a.Db({type:ot,selectors:[["app-lobby-center-container"]],decls:4,vars:1,template:function(t,e){1&t&&(a.yc(0),a.Kb(1,"app-lobby-audio-player"),a.Kb(2,"app-lobby-countdown"),a.Kb(3,"app-lobby-answer")),2&t&&a.Ac("",null==e.lobby||null==e.lobby.currentMusic||null==e.lobby.currentMusic.expectedAnswer?null:e.lobby.currentMusic.expectedAnswer.name," ")},directives:[V,W,it],encapsulation:2}),ot),ct=((nt=function e(){t(this,e)}).\u0275fac=function(t){return new(t||nt)},nt.\u0275cmp=a.Db({type:nt,selectors:[["app-lobby-playing"]],decls:1,vars:0,template:function(t,e){1&t&&a.Kb(0,"app-lobby-center-container")},directives:[bt],encapsulation:2}),nt);function rt(t,e){1&t&&(a.Mb(0),a.Kb(1,"app-lobby-waiting"),a.Lb())}function at(t,e){1&t&&(a.Mb(0),a.Kb(1,"app-lobby-playing"),a.Lb())}function ut(t,e){if(1&t&&(a.Mb(0),a.wc(1,rt,2,0,"ng-container",2),a.wc(2,at,2,0,"ng-container",2),a.Kb(3,"app-lobby-users"),a.Lb()),2&t){var n=a.Zb();a.zb(1),a.gc("ngIf",n.lobby.isWaiting()),a.zb(1),a.gc("ngIf",n.lobby.isPLaying())}}function lt(t,e){1&t&&a.yc(0,"loading")}var pt,ft,yt=[{path:"create",component:v},{path:":code",component:(pt=function(){function e(n,o,s,i,b,c){t(this,e),this.lobbyHttpService=n,this.router=o,this.route=s,this.lobbyEventSourceService=i,this.store=b,this.dialog=c,this.lobbyStatuses=l.c,this.subscriptions=[]}return n(e,[{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(t){return t.unsubscribe()})),this.store.dispatch(Object(g.a)()),this.lobbyEventSourceService.disconnect()}},{key:"ngOnInit",value:function(){var t=this;this.subscriptions.push(this.store.select("lobby").subscribe((function(e){e.lobby?(t.lobby=e.lobby,t.lobbyEventSourceService.joinLobby(t.lobby)):(t.route.paramMap.subscribe((function(e){t.lobbyCode=e.get("code")})),t.lobbyHttpService.join(t.lobbyCode).subscribe((function(e){t.dispatchLobby(e)}),(function(e){401===e.status&&t.dialog.open(w.a,{data:t.lobbyCode}).afterClosed().subscribe((function(e){e instanceof l.b?t.dispatchLobby(e):t.router.navigate(["/"])}))})))})))}},{key:"dispatchLobby",value:function(t){this.lobby=t.lobby,this.lobbyEventSourceService.joinLobby(this.lobby),this.store.dispatch(Object(g.b)({lobby:this.lobby,role:t.role,gameNames:t.gameNames}))}}]),e}(),pt.\u0275fac=function(t){return new(t||pt)(a.Jb(f.a),a.Jb(y.b),a.Jb(y.a),a.Jb(k),a.Jb(d.h),a.Jb(I.b))},pt.\u0275cmp=a.Db({type:pt,selectors:[["app-lobby"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],[4,"ngIf"]],template:function(t,e){if(1&t&&(a.wc(0,ut,4,2,"ng-container",0),a.wc(1,lt,1,0,"ng-template",null,1,a.xc)),2&t){var n=a.mc(2);a.gc("ngIf",e.lobby)("ngIfElse",n)}},directives:[r.l,K,T,ct],encapsulation:2}),pt)},{path:"**",redirectTo:"create"}],dt=((ft=function e(){t(this,e)}).\u0275mod=a.Hb({type:ft}),ft.\u0275inj=a.Gb({factory:function(t){return new(t||ft)},providers:[f.a,k],imports:[[r.c,y.f.forChild(yt),m.a]]}),ft)}}])}();