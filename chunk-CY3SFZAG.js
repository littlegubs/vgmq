import{a as ie}from"./chunk-AG3Z7YZV.js";import{a as F}from"./chunk-Z5CHWYDF.js";import{B as x,D as L,H as z,K as W,Ka as Z,La as Q,Ma as ee,Na as te,Q as $,ha as J,hb as ne,ja as X,v as B,w as g,x as Y,y as K,z as T}from"./chunk-2435743K.js";import{c as M}from"./chunk-3VSYNEYF.js";import{E as G,d as j,f as S,j as O,m as q}from"./chunk-3N5DGQTQ.js";import{Bb as p,Dc as h,Fc as A,Hc as V,M as v,Nb as l,Sb as I,Ub as N,Vb as H,Wb as R,Xb as r,Yb as i,Zb as f,bc as k,da as D,gc as c,hc as d,ib as o,nb as u,qa as C,ra as b,tc as a,uc as w,vb as P,vc as y,wb as U}from"./chunk-5HLPFG4U.js";import"./chunk-GAL4ENT6.js";function ue(t,m){if(t&1&&(r(0,"p",7),a(1),i()),t&2){let n=d();o(),w(n.errorMessage)}}var oe=(()=>{class t{dialogRef;profileHttpService;authService;errorMessage;constructor(n,s,e){this.dialogRef=n,this.profileHttpService=s,this.authService=e}submit(){this.profileHttpService.deleteUser().subscribe({next:()=>{this.dialogRef.close(),this.authService.logout()},error:({error:n})=>{this.errorMessage=n.message}})}close(){this.dialogRef.close()}static \u0275fac=function(s){return new(s||t)(u(J),u(F),u(M))};static \u0275cmp=P({type:t,selectors:[["app-confirm-delete-dialog"]],standalone:!1,decls:11,vars:1,consts:[[1,"tw-flex","tw-flex-col","tw-items-center","!tw-bg-grey"],[1,"!tw-mb-6","!tw-mt-2","tw-text-white","!tw-font-fastup","!tw-text-5xl","tw-text-center","tw-px-6"],[1,"tw-text-center","tw-font-bold"],[1,"tw-flex","tw-justify-center","tw-pb-4"],[1,"btn","tw-bg-red","tw-border-none","tw-text-white","hover:tw-border-solid","hover:tw-border-red",3,"click"],[1,"tw-ml-4","btn","btn-outline-primary",3,"click"],["class","text-danger tw-text-center",4,"ngIf"],[1,"text-danger","tw-text-center"]],template:function(s,e){s&1&&(r(0,"div",0)(1,"h1",1),a(2," Confirm Delete account "),i(),r(3,"p",2),a(4,"This action is irreversible, are you sure ?"),i(),r(5,"div",3)(6,"button",4),c("click",function(){return e.submit()}),a(7," Delete "),i(),r(8,"button",5),c("click",function(){return e.close()}),a(9,"Cancel"),i()(),p(10,ue,2,1,"p",6),i()),s&2&&(o(10),l("ngIf",e.errorMessage))},dependencies:[S],encapsulation:2})}return t})();function ae(){return t=>{let m=t.get("newPassword"),n=t.get("confirmNewPassword");return m&&n&&m.value!==n.value?{passwordMismatch:!0}:null}}var E=t=>({"is-invalid":t}),se=t=>({disabled:t});function fe(t,m){if(t&1&&(r(0,"span",26),a(1),i()),t&2){let n=m.$implicit;o(),w(n)}}function we(t,m){if(t&1&&(r(0,"p"),a(1," You unlocked benefits from these tiers: "),H(2,fe,2,1,"span",26,N),i()),t&2){let n=d(2);o(2),R(n.user.entitledTiers)}}function ge(t,m){t&1&&(r(0,"p"),a(1,"You haven't pledge to any tier"),i())}function he(t,m){t&1&&f(0,"span",27)}function _e(t,m){t&1&&f(0,"span",27)}function ve(t,m){if(t&1){let n=k();r(0,"p"),a(1,"Account linked with your Patreon account!"),i(),p(2,we,4,0,"p")(3,ge,2,0,"p"),r(4,"div",24)(5,"button",25),c("click",function(){C(n);let e=d();return b(!e.loadingUnlinkPatreon&&e.unlinkPatreon())}),a(6," Unlink account "),p(7,he,1,0,"span",17),i(),r(8,"button",25),c("click",function(){C(n);let e=d();return b(!e.loadingRefreshPatreon&&e.refreshPatreon())}),a(9," Refresh data "),p(10,_e,1,0,"span",17),i()()}if(t&2){let n=d();o(2),I((n.user==null?null:n.user.entitledTiers.length)>0?2:3),o(3),l("ngClass",h(5,se,n.loadingUnlinkPatreon)),o(2),l("ngIf",n.loadingUnlinkPatreon),o(),l("ngClass",h(7,se,n.loadingRefreshPatreon)),o(2),l("ngIf",n.loadingRefreshPatreon)}}function xe(t,m){if(t&1){let n=k();r(0,"p"),a(1,"Connect your account with Patreon to retrieve your benefits!"),i(),r(2,"div",28)(3,"button",29),c("click",function(){C(n);let e=d();return b(e.patreonOAuth())}),a(4,"Connect"),i()()}}function Ce(t,m){if(t&1&&(r(0,"p",30),a(1),i()),t&2){let n=d();o(),w(n.errorMessage)}}function be(t,m){if(t&1&&(r(0,"p",31),a(1),i()),t&2){let n=d();o(),w(n.successMessage)}}function Pe(t,m){t&1&&f(0,"span",27)}function ye(t,m){t&1&&(r(0,"p",32),a(1,"Passwords not match"),i())}function Se(t,m){if(t&1&&(r(0,"p",30),a(1),i()),t&2){let n=d();o(),w(n.errorMessage)}}function Me(t,m){if(t&1&&(r(0,"p",31),a(1),i()),t&2){let n=d();o(),w(n.successMessage)}}function Fe(t,m){t&1&&f(0,"span",27)}function Ee(t,m){t&1&&f(0,"span",27)}var le=(()=>{class t{dialog;profileHttpService;oauthHttpService;authService;user;userSub;loading=!1;errorMessage;successMessage;passwordForm=new T({currentPassword:new x("",g.required.bind(this)),newPassword:new x("",[g.required.bind(this),g.minLength(3)]),confirmNewPassword:new x("",[g.required.bind(this),g.minLength(3)])},{validators:ae()});usernameForm=new T({username:new x("",[g.required.bind(this),g.minLength(4)])});loadingUnlinkPatreon=!1;loadingRefreshPatreon=!1;constructor(n,s,e,_){this.dialog=n,this.profileHttpService=s,this.oauthHttpService=e,this.authService=_}ngOnInit(){this.userSub=this.getCurrentUser()}getCurrentUser(){return this.profileHttpService.getCurrentUser().subscribe(n=>{this.user=n})}submitUpdatePassword(){this.errorMessage=void 0,this.successMessage=void 0,this.loading=!0;let n=this.passwordForm.value;this.profileHttpService.updatePassword(n.currentPassword,n.newPassword).pipe(v(()=>{this.loading=!1,this.passwordForm.reset()})).subscribe({next:()=>{this.successMessage="Password changed successfully"},error:({error:s})=>{this.errorMessage=s.message}})}submitUpdateUsername(){this.errorMessage=void 0,this.successMessage=void 0,this.loading=!0;let n=this.usernameForm.value;this.profileHttpService.updateUsername(n.username).pipe(v(()=>{this.loading=!1,this.usernameForm.reset()})).subscribe({next:s=>{this.successMessage="Username changed successfully",this.authService.setAccessTokenCookie(s.accessToken),this.authService.setRefreshTokenCookie(s.refreshToken),this.getCurrentUser()},error:({error:s})=>{this.errorMessage=s.message}})}openDeleteDialog(){this.dialog.open(oe)}ngOnDestroy(){this.userSub.unsubscribe()}patreonOAuth(){window.open(`https://www.patreon.com/oauth2/authorize?response_type=code&client_id=nfItBwy3Cx9lObjpVyANkAgm3Z6GFHHoBOGIg_cCJY4lI-Xqwx6rdmKKKozBxSx9&redirect_uri=${window.location.origin}/oauth/patreon`,"_self")}refreshPatreon(){this.loadingRefreshPatreon=!0,this.oauthHttpService.refreshPatreon().subscribe(()=>{this.profileHttpService.getCurrentUser().pipe(v(()=>this.loadingRefreshPatreon=!1)).subscribe(n=>{this.user=n})})}unlinkPatreon(){this.loadingUnlinkPatreon=!0,this.oauthHttpService.unlinkPatreon().pipe(v(()=>this.loadingUnlinkPatreon=!1)).subscribe(()=>{this.user.patreonAccount=null})}static \u0275fac=function(s){return new(s||t)(u(X),u(F),u(ie),u(M))};static \u0275cmp=P({type:t,selectors:[["app-profile"]],standalone:!1,decls:70,vars:32,consts:[[1,"tw-flex","tw-flex-col","md:tw-flex-row","tw-w-full","md:tw-justify-center","tw-items-center","tw-gap-4"],[1,"tw-flex","tw-flex-col","tw-flex-1"],[1,"tw-text-center","!tw-text-2xl","!tw-font-fastup"],[1,"tw-font-bold"],[1,"tw-my-4"],[1,"bg-dark","tw-mt-2","tw-rounded-3xl"],[1,"tw-p-4"],[1,"tw-my-2"],["height","24px","width","24px","src","assets/svg/PATREON_SYMBOL_1_WHITE_RGB.svg"],["height","24px","src","assets/svg/PATREON_WORDMARK_1_WHITE_RGB.svg",1,"tw-ms-[12px]"],[1,"!tw-bg-newBlack"],[1,"tw-flex","tw-flex-col","tw-items-center"],[1,"tw-w-3/4",3,"ngSubmit","formGroup"],["type","text","required","","formControlName","username",1,"form-control","!tw-bg-grey","tw-rounded-md","placeholder:tw-text-light-grey","tw-mt-2",3,"placeholder","ngClass"],["class","!tw-my-4 text-danger tw-text-center",4,"ngIf"],["class","!tw-my-4 text-success tw-text-center",4,"ngIf"],["type","submit",1,"btn","btn-outline-primary",3,"disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","password","required","","formControlName","currentPassword","placeholder","Current Password",1,"form-control","!tw-bg-grey","tw-rounded-md","placeholder:tw-text-light-grey","tw-mt-2",3,"ngClass"],["type","password","required","","formControlName","newPassword","placeholder","New Password",1,"form-control","!tw-bg-grey","tw-rounded-md","placeholder:tw-text-light-grey","tw-my-4",3,"ngClass"],["type","password","required","","formControlName","confirmNewPassword","placeholder","Confirm new password",1,"form-control","!tw-bg-grey","tw-rounded-md","placeholder:tw-text-light-grey",3,"ngClass"],["class","!tw-my-4",4,"ngIf"],[1,"tw-flex","tw-justify-center","tw-mt-2"],[1,"btn","tw-bg-red","tw-border-none","tw-text-white","hover:tw-border-solid","hover:tw-border-red",3,"click"],[1,"tw-flex","tw-justify-center","tw-gap-4"],[1,"btn","btn-sm","btn-primary",3,"click","ngClass"],[1,"text-primary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"tw-flex","tw-justify-center"],[1,"btn","btn-sm","btn-primary","tw-my-2",3,"click"],[1,"!tw-my-4","text-danger","tw-text-center"],[1,"!tw-my-4","text-success","tw-text-center"],[1,"!tw-my-4"]],template:function(s,e){s&1&&(r(0,"div",0)(1,"div",1)(2,"h4",2),a(3,"Personal Informations"),i(),r(4,"div")(5,"span",3),a(6,"Username:"),i(),a(7),i(),r(8,"div",4)(9,"span",3),a(10,"Email:"),i(),a(11),i(),r(12,"div")(13,"span",3),a(14,"Member since:"),i(),a(15),A(16,"date"),i(),r(17,"div",5)(18,"div",6)(19,"div",7),f(20,"img",8)(21,"img",9),i(),p(22,ve,11,9)(23,xe,5,0),i()()(),r(24,"div",1)(25,"h4",2),a(26,"Settings"),i(),r(27,"mat-accordion")(28,"mat-expansion-panel",10)(29,"mat-expansion-panel-header")(30,"mat-panel-title"),a(31,"Update Username"),i()(),r(32,"div",11)(33,"ul")(34,"li"),a(35,"Updating your username is a premium feature, and can only be done once a month."),i()(),r(36,"form",12),c("ngSubmit",function(){return e.submitUpdateUsername()}),f(37,"input",13),r(38,"div",11),p(39,Ce,2,1,"p",14)(40,be,2,1,"p",15),r(41,"div",4)(42,"button",16),a(43," Update"),p(44,Pe,1,0,"span",17),i()()()()()(),r(45,"mat-expansion-panel",10)(46,"mat-expansion-panel-header")(47,"mat-panel-title"),a(48,"Update Password"),i()(),r(49,"div",11)(50,"form",12),c("ngSubmit",function(){return e.submitUpdatePassword()}),f(51,"input",18)(52,"input",19)(53,"input",20),r(54,"div",11),p(55,ye,2,0,"p",21)(56,Se,2,1,"p",14)(57,Me,2,1,"p",15),r(58,"div",4)(59,"button",16),a(60," Update"),p(61,Fe,1,0,"span",17),i()()()()()(),r(62,"mat-expansion-panel",10)(63,"mat-expansion-panel-header")(64,"mat-panel-title"),a(65,"Delete Account"),i()(),r(66,"div",22)(67,"button",23),c("click",function(){return e.openDeleteDialog()}),a(68," Delete my account"),p(69,Ee,1,0,"span",17),i()()()()()()),s&2&&(o(7),y(" ",e.user==null?null:e.user.username,""),o(4),y(" ",e.user==null?null:e.user.email,""),o(4),y(" ",V(16,21,e.user==null?null:e.user.createdAt,"MM-dd-YYYY"),""),o(7),I(e.user!=null&&e.user.patreonAccount?22:23),o(14),l("formGroup",e.usernameForm),o(),l("placeholder",e.user==null?null:e.user.username)("ngClass",h(24,E,e.usernameForm.get("username")&&e.usernameForm.get("username").invalid&&(e.usernameForm.get("username").dirty||e.usernameForm.get("username").touched))),o(2),l("ngIf",e.errorMessage),o(),l("ngIf",e.successMessage),o(2),l("disabled",e.usernameForm.invalid||(e.usernameForm.errors==null?null:e.usernameForm.errors.passwordMismatch)),o(2),l("ngIf",e.loading),o(6),l("formGroup",e.passwordForm),o(),l("ngClass",h(26,E,e.passwordForm.get("currentPassword")&&e.passwordForm.get("currentPassword").invalid&&(e.passwordForm.get("currentPassword").dirty||e.passwordForm.get("currentPassword").touched))),o(),l("ngClass",h(28,E,e.passwordForm.get("newPassword")&&e.passwordForm.get("newPassword").invalid&&(e.passwordForm.get("newPassword").dirty||e.passwordForm.get("newPassword").touched))),o(),l("ngClass",h(30,E,e.passwordForm.get("confirmNewPassword")&&e.passwordForm.get("confirmNewPassword").invalid&&(e.passwordForm.get("confirmNewPassword").dirty||e.passwordForm.get("confirmNewPassword").touched))),o(2),l("ngIf",e.passwordForm.errors==null?null:e.passwordForm.errors.passwordMismatch),o(),l("ngIf",e.errorMessage),o(),l("ngIf",e.successMessage),o(2),l("disabled",e.passwordForm.invalid||(e.passwordForm.errors==null?null:e.passwordForm.errors.passwordMismatch)),o(2),l("ngIf",e.loading),o(8),l("ngIf",e.loading))},dependencies:[j,S,te,Z,Q,ee,L,B,Y,K,$,z,W,O],encapsulation:2})}return t})();var Ie=[{path:"",component:le}],Le=(()=>{class t{static \u0275fac=function(s){return new(s||t)};static \u0275mod=U({type:t});static \u0275inj=D({imports:[q,G.forChild(Ie),ne]})}return t})();export{Le as ProfileModule};
